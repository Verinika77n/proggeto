{% extends 'base.html' %}
{% block content %}
{% load blog_filters %}
<div class="container-fluid">

  <div class="mt-4">
    <a class="btn btn-outline-secondary" href="{{ request.META.HTTP_REFERER }}">‚Üê –ù–∞–∑–∞–¥</a>
  </div>

  <h1 class="mb-3">{{ entry.fname }} {{ entry.lname }}</h1>
  <p class="text-muted">
    <small>
      –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {{ entry.created_at|date:'d.m.Y' }}
      {% if entry.user %} ¬∑ –Ω–∏–∫: {{ entry.user.username }}{% endif %}
    </small>
  </p>

  <div class="row">
    <div class="col-md-4">
      {% if entry.photo %}
      <img src="{{ entry.photo.url }}" class="img-thumbnail mb-3" alt="{{ entry.fname }} {{ entry.lname }}"
        style="width:270px; height:270px; object-fit:cover;">
      {% else %}
      <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mx-auto"
        style="width:160px; height:160px; color:white;">
        <span class="fs-1">{{ entry.user.username|slice:":1"|upper }}</span>
      </div>
      {% endif %}
    </div>

    <div class="col-md-8">
      <ul class="list-group list-group-flush" style="font-size: 20px;">
        {% if entry.birth_date %}
        <li class="list-group-item"><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ entry.birth_date|date:"d.m.Y" }}</li>
        {% endif %}
        <li class="list-group-item"><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> {{ entry.get_age }} </li>
        {% if entry.phone %}
        <li class="list-group-item"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ entry.phone }}</li>
        {% endif %}
        {% if entry.gender %}
        <li class="list-group-item"><strong>–ü–æ–ª:</strong> {{ entry.gender }}</li>
        {% endif %}
        {% if entry.about %}
        <li class="list-group-item"><strong>–û —Å–µ–±–µ:</strong> {{ entry.about }}</li>
        {% else %}
        <li class="list-group-item"><strong>–û —Å–µ–±–µ:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –æ —Å–µ–±–µ –Ω–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª</li>
        {% endif %}
      </ul>

      {% if user.is_authenticated %}
      {% if entry.user == user or user.is_staff %}
      <div class="mt-3">
        <a href="{% url 'profiles-edit' entry.id %}" class="btn btn-primary btn-sm">–ò–∑–º–µ–Ω–∏—Ç—å</a>
        <a href="{% url 'profiles-delete' entry.id %}" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</a>
      </div>
      {% endif %}
      {% endif %}
      </div>
      <h3> –ó–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
      <div class="mt-4">
      {% if entry.user.blog.count == 0 %}
      <p>–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π.</p>
      {% endif %}
      
      {% for e in entry.user.blog.all %}
      <div class="card mb-4" style="max-width: 100%; margin-left: auto; margin-right: auto;">
        <div class="card-header">
          <a href="{% url 'profiles-detail' e.user.profile.id %}" 
          class="nav-link active">–ê–≤—Ç–æ—Ä: {{ e.user.profile.fname }}
            {{ e.user.profile.lname }} </a>
          <p>–°–æ–∑–¥–∞–Ω–æ: {{ e.created_at }}</p>
        </div>

        <div class="card-body">
          <a class="nav-link active" href="{% url 'blog-detail' e.id %}">{{ e.content }}</p>
        </div>

        {% if e.image %}
        <div class="card-header" style="border: 1px; border-color: darkgrey; border-style:outset;">
          <img src="{{ e.image.url }}" class="rounded mx-auto d-block" style="max-height: 500px;"
            alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏">
        </div>
        {% endif %}
       
<div class="card-body" >
    <form method="post" action="{% url 'blog' %}">
      {% csrf_token %}
      <input type="hidden" name="e_id" value="{{ e.id }}">

    <button type="submit" class="btn btn-sm btn-outline-primary">
        {% if e|is_liked_by:user %}
            ‚ù§Ô∏è
        {% else %}
            ü§ç
        {% endif %}
        {{ e.likes_count }}
    </button>
    </form>
  </div>

  <div class="card-header text-muted">
    <a href="{% url 'blog-detail' e.id %}#comments-section" class="nav-link active">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ e.comments.count }})</a>
</div>
</div>
        {% endfor %}


      </div>
    
  </div>
  {% endblock %}